(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{187:function(t,s,n){"use strict";n.r(s);var a=n(0),e=Object(a.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[t._m(0),n("p",[n("a",{attrs:{href:"https://yuchengkai.cn/docs/zh/frontend/react.html#react-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%88%86%E6%9E%90",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考文章：原文链接"),n("OutboundLink")],1)]),n("p",[n("a",{attrs:{href:"https://www.zcfy.cc/article/update-on-async-rendering",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考文章：ReactV16.3即将更改的生命周期"),n("OutboundLink")],1)]),n("p",[t._v("在V16版本中引入了Fiber机制。这个机制在一定程度上影响了部分生命周期的调用，并且引入了新的2个API来解决问题。")]),t._m(1),t._m(2),t._m(3),t._m(4),t._m(5),t._m(6),t._m(7),t._m(8),t._m(9),t._m(10),t._m(11),t._m(12),t._m(13),t._m(14),t._m(15),t._m(16),n("p",[t._v("getDerivedStateFromProps")]),t._m(17),t._m(18),t._m(19)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"react生命周期分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#react生命周期分析","aria-hidden":"true"}},[this._v("#")]),this._v(" React生命周期分析")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在之前的版本中，如果你拥有一个很复杂的复合组件，然后改动了最上层组件的state，那么调用栈可能会很长\n"),s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/6/25/164358b0310f476c?w=685&h=739&f=png&s=61462",alt:"image"}}),this._v("\n调用栈过长，再加上中间进行了复杂的操作，就可能导致长时间阻塞主线程，带来不好的用户体验。Fiber就是为了解决该问题而生。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Fiber本质上是一个虚拟的堆栈帧，新的调度器会按照优先级自由调度这些帧，从而将之前的额同步渲染改成异步渲染，在不影响体验的情况下去分段计算更新。\n"),s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/6/25/164358f89595d56f?w=1119&h=600&f=png&s=330885",alt:"image"}}),this._v("\n对于如何区别优先级，React有自己的一套逻辑。对于动画这种实时性很高的东西，也就是"),s("code",[this._v("16ms")]),this._v("必须渲染一次保证不卡顿的情况下，Reac会每"),s("code",[this._v("16ms（以内）")]),this._v("暂停一下更新，返回来继续渲染动画。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("对于异步渲染，现在渲染有两个阶段："),s("code",[this._v("reconciliation")]),this._v("和"),s("code",[this._v("commit")]),this._v("。前者过程是可以打断的，后者不能暂停，会一直更新界面直到完成。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"reconciliation阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reconciliation阶段","aria-hidden":"true"}},[this._v("#")]),this._v(" Reconciliation阶段")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("componentWillMount")]),s("li",[this._v("componentWillReceiveProps")]),s("li",[this._v("shouldComponentUpdate")]),s("li",[this._v("componentWillUpdate")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"commit阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#commit阶段","aria-hidden":"true"}},[this._v("#")]),this._v(" Commit阶段")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("componentDidMount")]),s("li",[this._v("componentDidUpdate")]),s("li",[this._v("componentWillUnmount")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("因为"),n("code",[t._v("reconciliation")]),t._v("阶段是可以被打断的，所以"),n("code",[t._v("reconciliation")]),t._v("阶段会执行的生命周期函数就可能会出现调用多次的情况，从而引起Bug。所以对于"),n("code",[t._v("reconciliation")]),t._v("阶段调用的几个函数，除了"),n("code",[t._v("shouldComponentUpdate")]),t._v("以外，其他都应该避免去使用，并且V16也引入了新的API来解决这个问题。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("getDerivedStateFromProps")]),this._v("用于替换"),s("code",[this._v("componentWillReceiveProps")]),this._v("，该函数会在初始化和update时被调用")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("ExampleComponent")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("React"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Component")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  state "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("getDerivedStateFromProps")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextProps"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prevState"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prevState"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("someMirroredValue "),n("span",{attrs:{class:"token operator"}},[t._v("!==")]),t._v(" nextProps"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("someValue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        derivedData"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("computeDerivedState")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextProps"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        someMirroredValue"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nextProps"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("someValue\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// Return null to indicate no change to state.")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("getSnapshotBeforeUpdate")]),this._v("用于代替"),s("code",[this._v("componentWillUpdate")]),this._v(",该函数会在"),s("code",[this._v("update")]),this._v("后的DOM更新前被调用，用于读取最新的DOM数据")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"v16-生命周期函数用法建议"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#v16-生命周期函数用法建议","aria-hidden":"true"}},[this._v("#")]),this._v(" V16 生命周期函数用法建议")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("ExampleComponent")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("React"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Component")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 用于初始化 state")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("constructor")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 用于替换 `componentWillReceiveProps` ，该函数会在初始化和 `update` 时被调用")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 因为该函数是静态函数，所以取不到 `this`")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 如果需要对比 `prevProps` 需要单独在 `state` 中维护")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("getDerivedStateFromProps")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextProps"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prevState"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 判断是否需要更新组件，多用于组件性能优化")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("shouldComponentUpdate")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextProps"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextState"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 组件挂载后调用")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 可以在该函数中进行请求或者订阅")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("componentDidMount")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 用于获得最新的 DOM 数据")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("getSnapshotBeforeUpdate")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 组件即将销毁")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 可以在此处移除订阅，定时器等等")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("componentWillUnmount")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 组件销毁后调用")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("componentDidUnMount")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 组件更新后调用")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("componentDidUpdate")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 渲染组件函数")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("render")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 以下函数不建议使用")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("UNSAFE_componentWillMount")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("UNSAFE_componentWillUpdate")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextProps"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextState"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("UNSAFE_componentWillReceiveProps")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextProps"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"新增的生命周期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新增的生命周期","aria-hidden":"true"}},[this._v("#")]),this._v(" 新增的生命周期")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("新增的"),s("code",[this._v("getDerivedStateFromProps")]),this._v("和"),s("code",[this._v("getSnapshotBeforeUpdate")]),this._v("如果存在以前的willMount,willReceiveProps,willUpdate,会报警告")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:""}},[s("a",{staticClass:"header-anchor",attrs:{href:"#","aria-hidden":"true"}},[this._v("#")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("该方法是静态的，使用需要加上static")]),s("li",[this._v("该方法返回值将会更新state(返回null不更新)，这样我们可以将props的值返回更新state，那么所有状态都由state来维护")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"getsnapshotbeforeupdate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#getsnapshotbeforeupdate","aria-hidden":"true"}},[this._v("#")]),this._v(" getSnapshotBeforeUpdate")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("和以前的区别在于返回值将作为didUpdate的第三个参数")])])}],!1,null,null,null);e.options.__file="4.md";s.default=e.exports}}]);